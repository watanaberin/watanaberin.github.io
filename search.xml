<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>å­¦å¤–è¯­å¦‚ä½•æ¯äº†æˆ‘</title>
    <url>/post/2369de45.html</url>
    <content><![CDATA[<p>åŸæ–‡ from youtube <a href="https://www.youtube.com/watch?v=ZZ_4gzoDDAE">å­¦å¤–è¯­å¦‚ä½•æ¯äº†æˆ‘</a></p>
<p>In summer 2015 when I was walking by Magus Books, my favorite bookstore in Seattle. At 3 AM morning, my eyes were immediately caught by the title of a book in the yellow glim behind the window. So I went the next morning, bought it, and read it. The book was properly not the best collection of essays I had read, but the title has since then stayed with me â€œThe Moral Obligation To Be Intelligentâ€. What does that have to do with learning languages? <span id="more"></span>Does speaking foreign languages make you more intelligent? Depends. Is the ability to speak another language part of intelligence? Not necessarily. But being intelligent and knowing foreign languages do share one thing in common: they are both painful. And by â€œpainfulâ€ I donâ€™t mean the ennui of tediously long lectures or vocabulary and grammatical studies or the expense of time for the pursuit of wisdom and knowledge nor even the loneliness your dedication to the endeavor could bring upon you. The pain, the true torment, is the confusion. For the bigger the circle of the known, the greater the contact with the unknown, and the more firmly unlearnt beliefs used to stand, the more helplessly your new identity totters. If you are lucky enough to study Farsi, you may realize that not all beautiful poetry is written in your mother tongue and that Persian epics written in the Sasanian Empire are as beautiful as poems of the Tang Dynasty. If you happen to study Spanish you may realize that what you thought is unique and an aspect of your culture has a similar counterpart in another culture, that the Porto Rican Morcilla is almost identical to the Korean Sundae. If Russian is your language, you may realize that not all the important battles that change the course of human history were fought on your native land, that the Russian defeat of the Golden Horde at the field of Kulikobo is no less significant than the Reconquest of Granada in Spain. Canâ€™t you do this by reading history? One may ask. Yes, but history written by whom, for whom? Because you see, after learning a language, if you care enough, part of you becomes a member of the tribe to which the language belongs. And that cultural schizophrenia can be truly excruciating. That pain, however, cannot be easily offset by the better chances of employment in the job market by the better chances of employment in the job market or the simple pleasure of impressing your friends at the dinner table with political anecdotes played out in five different languages. Why, then, would anyone whoâ€™s not a crazy masochist want to learn a foreign language? Yes, to communicate with people. Yes, to travel to different places. Yes, to advance your career in a globalized world. Yes, it is good for your brain. But more importantly, as potentially excruciating as it is for those curious enough to see the world as it is and those brave enough to tear down the veils of bigotry instead of hiding behind the lingustic barrier and refusing to step forward and know your fellow human beings or even the so-called enemie. I am by no means accusing those not fond of foreign languages of being cowards if anything they have to be forever more on their guard of the bigotries the fatuities and the language barrier and constantly seek more reliable sources of information indeed the pursuit of knowledge is almost by definition a sort of masochism and language learning is no exception but in such pain and perhaps only in such pain can we overcome misunderstandings bridge cultures and civilizations and find a world of peace and prosperity.</p>
]]></content>
      <categories>
        <category>language</category>
      </categories>
      <tags>
        <tag>è¯­è¨€</tag>
        <tag>youtube</tag>
      </tags>
  </entry>
  <entry>
    <title>æˆ‘çš„Macä¸Šå®‰è£…äº†ä»€ä¹ˆè½¯ä½“</title>
    <url>/post/efa67fef.html</url>
    <content><![CDATA[<p>è¿™äº›è½¯ä½“ä¹Ÿè®¸æˆ‘æ˜¯éå®ƒä»¬ä¸å¯ï¼Œ<br><a href="https://www.sublimetext.com/">Sublime Text</a>(æ–‡æœ¬ç¼–è¾‘å™¨)ã€<a href="https://apps.apple.com/us/app/pure-paste/id1611378436?mt=12">Pure Paste</a>(å¤åˆ¶æ–‡æœ¬æ—¶æ¸…é™¤æ ¼å¼)ã€<a href="https://apps.apple.com/us/app/moom/id419330170?mt=12">Moom</a>(çª—å£å¸ƒå±€)ã€<a href="https://www.alfredapp.com/">Alfred</a>(åŸºäºworkflowçš„æ•ˆç‡å·¥å…·)ã€<a href="https://github.com/oldj/SwitchHosts">SwitchHost</a>(åˆ‡æ¢hostsæ–‡ä»¶)ã€<a href="https://www.snipaste.com/">Snipaste</a>(å±å¹•æˆªå›¾å·¥å…·)ã€<a href="https://www.renfei.org/snippets-lab/">SnippetsLab</a>(ä»£ç ç‰‡æ®µå·¥å…·)ã€<a href="https://calibre-ebook.com/">Calibre</a>(ç”µå­ä¹¦ç®¡ç†å·¥å…·)ã€<a href="https://apps.apple.com/cn/app/runcat/id1429033973?mt=12">RunCat</a>(èœå•æ æŒ‚ä»¶ &amp; ç³»ç»Ÿç”¨é‡å·¥å…·)ã€<a href="https://obsidian.md/">Obisidian</a>(ç¬”è®°å·¥å…·)ã€<a href="https://www.spotify.com/us/download/mac/">Spotify</a>(ğŸµ)ã€‚</p>
<span id="more"></span>
<p>ä»¥åŠè‹¹æœè‡ªå¸¦çš„Mailã€Remindersã€Calendarã€‚</p>
]]></content>
      <categories>
        <category>productivity</category>
      </categories>
      <tags>
        <tag>Mac</tag>
        <tag>software</tag>
      </tags>
  </entry>
  <entry>
    <title>Centoså•æœºæ­å»ºKafka</title>
    <url>/post/911f542f.html</url>
    <content><![CDATA[<h3 id="JAVA-ç¯å¢ƒ-ï¼ˆJDK-1-8ï¼‰"><a href="#JAVA-ç¯å¢ƒ-ï¼ˆJDK-1-8ï¼‰" class="headerlink" title="JAVA ç¯å¢ƒ ï¼ˆJDK 1.8ï¼‰"></a>JAVA ç¯å¢ƒ ï¼ˆJDK 1.8ï¼‰</h3><ol>
<li><p>ä¸‹è½½å®‰è£…åŒ…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget --no-cookies --no-check-certificate --header <span class="string">&quot;Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie&quot;</span> <span class="string">&quot;http://download.oracle.com/otn-pub/java/jdk/8u141-b15/336fa29ff2bb4ef291e347e091f7f4a7/jdk-8u141-linux-x64.tar.gz&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ›å»ºå®‰è£…ç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /usr/local/java/</span><br></pre></td></tr></table></figure></li>
<li><p>è§£å‹è‡³å®‰è£…ç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zxvf jdk-8u171-linux-x64.tar.gz -C /usr/local/java/</span><br></pre></td></tr></table></figure>
<span id="more"></span></li>
<li><p>è®¾ç½®ç¯å¢ƒå˜é‡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># ç¯å¢ƒå˜é‡</span></span><br><span class="line">vi /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨æœ«å°¾æ·»åŠ ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/local/java/jdk1.8.0_171</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure></li>
<li><p>æ·»åŠ è½¯é“¾æ¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s /usr/local/java/jdk1.8.0_171/bin/java /usr/bin/java</span><br></pre></td></tr></table></figure></li>
<li><p>æ£€æŸ¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">java -version</span><br><span class="line"></span><br><span class="line">java version <span class="string">&quot;1.8.0_141&quot;</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_141-b15)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.141-b15, mixed mode)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="å®‰è£…zookeeper"><a href="#å®‰è£…zookeeper" class="headerlink" title="å®‰è£…zookeeper"></a>å®‰è£…zookeeper</h3><ol>
<li>åœ¨<a href="https://zookeeper.apache.org/releases.html#download">å®˜ç½‘</a>è¿›å…¥Downloadè·å¾—ä¸‹è½½é“¾æ¥ğŸ”—<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://dlcdn.apache.org/zookeeper/zookeeper-3.5.10/apache-zookeeper-3.5.10-bin.tar.gz</span><br></pre></td></tr></table></figure></li>
<li>è§£å‹åˆ°æŒ‡å®šä½ç½®<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -xf apache-zookeeper-3.5.10-bin.tar.gz</span><br><span class="line"><span class="built_in">cp</span> apache-zookeeper-3.5.10-bin ~/workspace/zookeeper</span><br></pre></td></tr></table></figure></li>
<li>é…ç½®æ–‡ä»¶<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> zoo_sample.cfg zoo.cfg</span><br></pre></td></tr></table></figure></li>
<li>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹äº†dateDirä½ç½®<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[rin@localhost conf]$ <span class="built_in">cat</span> zoo.cfg | grep -v <span class="string">&quot;^#&quot;</span> | grep -v <span class="string">&quot;^$&quot;</span></span><br><span class="line">tickTime=2000</span><br><span class="line">initLimit=10</span><br><span class="line">syncLimit=5</span><br><span class="line">dataDir=/home/workspace/data</span><br><span class="line">clientPort=2181</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>å¯åŠ¨<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./bin/zkServer.sh start</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="å®‰è£…Kafka"><a href="#å®‰è£…Kafka" class="headerlink" title="å®‰è£…Kafka"></a>å®‰è£…Kafka</h3><ol>
<li><p>ä¸‹è½½å®‰è£…åŒ…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wget https://archive.apache.org/dist/kafka/2.6.0/kafka_2.13-2.6.0.tgz</span><br></pre></td></tr></table></figure></li>
<li><p>è§£å‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tar -zxvf kafka_2.13-2.6.0.tgz</span><br><span class="line">mv kafka_2.13-2.6.0 /home/kafka</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¼–è¾‘config&#x2F;server.propeties, åªè°ƒæ•´äº†logçš„ä½ç½®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[rin@localhost config]$ <span class="built_in">cat</span> server.properties | grep -v <span class="string">&quot;^#&quot;</span> | grep -v <span class="string">&quot;^$&quot;</span></span><br><span class="line">broker.id=0</span><br><span class="line">num.network.threads=3</span><br><span class="line">num.io.threads=8</span><br><span class="line">socket.send.buffer.bytes=102400</span><br><span class="line">socket.receive.buffer.bytes=102400</span><br><span class="line">socket.request.max.bytes=104857600</span><br><span class="line">log.dirs=/var/log/kafka-logs</span><br><span class="line">num.partitions=1</span><br><span class="line">num.recovery.threads.per.data.dir=1</span><br><span class="line">offsets.topic.replication.factor=1</span><br><span class="line">transaction.state.log.replication.factor=1</span><br><span class="line">transaction.state.log.min.isr=1</span><br><span class="line">log.retention.hours=168</span><br><span class="line">log.segment.bytes=1073741824</span><br><span class="line">log.retention.check.interval.ms=300000</span><br><span class="line">zookeeper.connect=localhost:2181</span><br><span class="line">zookeeper.connection.timeout.ms=18000</span><br><span class="line">group.initial.rebalance.delay.ms=0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯åŠ¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./kafka-server-start.sh ../config/server.properties &amp;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>éƒ¨ç½²å®Œæˆæµ‹è¯•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@kafka bin]<span class="comment"># ./kafka-topics.sh --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic test</span></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æœ¬æœºçš„topic</span></span><br><span class="line">[root@kafka bin]<span class="comment"># ./kafka-topics.sh --list --bootstrap-server localhost:9092</span></span><br><span class="line"><span class="built_in">test</span></span><br><span class="line"><span class="comment">#å‘é€æ¶ˆæ¯åˆ°test</span></span><br><span class="line">[root@kafka bin]<span class="comment"># ./kafka-console-producer.sh --broker-list localhost:9092 --topic test</span></span><br><span class="line">&gt;aaa</span><br><span class="line">&gt;bbb</span><br><span class="line">&gt;ccc</span><br><span class="line"><span class="comment">#å¼€å¯æ–°çš„ç»ˆç«¯ï¼Œè¿›è¡Œè¯»å–æ¶ˆæ¯æµ‹è¯•ï¼Œâ€œ--from-beginningâ€è¡¨ç¤ºä»å¼€å¤´è¯»å–</span></span><br><span class="line">[root@kafka bin]<span class="comment"># ./kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning</span></span><br><span class="line">aaa</span><br><span class="line">bbb</span><br><span class="line">ccc</span><br></pre></td></tr></table></figure>

<h4 id="å¼€æ”¾KafkaæœåŠ¡ç«¯å£"><a href="#å¼€æ”¾KafkaæœåŠ¡ç«¯å£" class="headerlink" title="å¼€æ”¾KafkaæœåŠ¡ç«¯å£"></a>å¼€æ”¾KafkaæœåŠ¡ç«¯å£</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 9092 æ˜¯kafkaçš„ç«¯å£</span></span><br><span class="line">firewall-cmd --zone=public --add-port=9092/tcp --permanent</span><br><span class="line"><span class="comment">#é‡å¯é˜²ç«å¢™</span></span><br><span class="line">firewall-cmd --reload</span><br><span class="line"><span class="comment"># ç¡®è®¤å¼€å¯ç«¯å£</span></span><br><span class="line">firewall-cmd --list-ports</span><br><span class="line">9092/tcp</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>tech</category>
      </categories>
      <tags>
        <tag>Kafka</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonæ¨¡å—å’ŒåŒ…ç®¡ç†</title>
    <url>/post/55c2460.html</url>
    <content><![CDATA[<h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>åœ¨ Python ä¸­æ¯ä¸€ä¸ª .py éƒ½å¯ä»¥è§†ä½œä¸€ä¸ªæ¨¡å—ï¼ˆmoduleï¼‰ï¼Œè€Œæ¯ä¸€ä¸ªåŒ…å« <strong>init</strong>.py çš„ç›®å½•åˆ™å¯ä»¥è§†ä½œåŒ…ï¼ˆpackgeï¼‰ã€‚</p>
<p>åœ¨ one.py ä¸­ç®€å•å®šä¹‰äº†ä¸€ä¸ªå‡½æ•° One:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">def One():</span><br><span class="line">    print(&quot;module one&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def OneOne():</span><br><span class="line">    print(&quot;module one/one&quot;)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨ main.py ä¸­ä½¿ç”¨çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥ importï¼Œè¿™ç§æ–¹å¼ä¹Ÿç§°ä¹‹ä¸ºâ€œæ¨¡å—å¯¼å…¥â€ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import packs</span><br><span class="line"></span><br><span class="line">packs.one.One()</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œåå°±ä¼šæ‰“å° module oneï¼Œå¦å¤–ä¹Ÿå¯ä»¥çœ‹åˆ°åœ¨ packs ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª <strong>pycache</strong> çš„æ–°ç›®å½•ï¼Œè¿™æ˜¯ç¼–è¯‘åä¸­é—´æ–‡ä»¶ï¼Œå¯ä»¥æå‡æ¨¡å—è½½å…¥é€Ÿåº¦ã€‚</p>
<span id="more"></span>

<p>é™¤äº†è¿™ç§å…¨å±€å¯¼å…¥å¤–ï¼Œè¿˜å¯ä»¥åœ¨å±€éƒ¨ä½œç”¨åŸŸå¯¼å…¥ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">def main():</span><br><span class="line">    from packs.one import One</span><br><span class="line">    One()</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>
<h3 id="init-æ–‡ä»¶"><a href="#init-æ–‡ä»¶" class="headerlink" title="init æ–‡ä»¶"></a>init æ–‡ä»¶</h3><p><strong>init</strong>.py æ¯å½“å¯¼å…¥å½“å‰åŒ…çš„æ¨¡å—çš„æ—¶å€™å°±ä¼šè¿è¡Œä¸€æ¬¡ã€‚<br>æˆ‘ä»¬å¯ä»¥å† <strong>init</strong>.py è¾“å…¥å¯¼å‡ºçš„æ¨¡å—ï¼Œå¤–éƒ¨ä½¿ç”¨çš„å°±ä¸éœ€è¦å¾ˆé•¿çš„å¯¼å…¥è·¯å¾„äº†ã€‚</p>
<p>ä¿®æ”¹ packs&#x2F;__init__py ä¸ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">from .one import One</span><br></pre></td></tr></table></figure>
<p>print(â€œpacks one importedâ€)<br>é‚£ä¹ˆåœ¨ main.py ä¸­å°±å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">from packs import One</span><br></pre></td></tr></table></figure>
<p>One()<br>æˆ–è€…è¿™æ ·å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import packs</span><br><span class="line"></span><br><span class="line">packs.One()</span><br></pre></td></tr></table></figure>

<h3 id="ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„å¼•ç”¨"><a href="#ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„å¼•ç”¨" class="headerlink" title="ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„å¼•ç”¨"></a>ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„å¼•ç”¨</h3><p>è¿™ç§å¸¦æœ‰ç›¸å¯¹è·¯å¾„çš„å¯¼å…¥è·¯å¾„ from .XXXï¼Œè¿™ç§ä»£è¡¨ä»å½“å‰çš„ XXX æ¨¡å—ä¸­å¯¼å…¥åç§°ã€‚<br>å¦‚æœæƒ³è¦åœ¨å½“å‰æ¨¡å—ä¸­ä½¿ç”¨ä¸Šä¸€å±‚çš„ packs&#x2F;one.py å°±å¯ä»¥ä½¿ç”¨ from ..one import One çš„æ–¹å¼ã€‚</p>
<p>ä»¥æ­¤ç±»æ¨ï¼Œé‚£ä¹ˆ â€¦ ä»£è¡¨æ›´ä¸Šä¸€çº§ã€‚</p>
<p>ä½†æ˜¯è¿™ç§æ–¹å¼è¿˜æ˜¯æœ‰é—®é¢˜çš„ï¼Œå¦‚æœé¡¹ç›®æ·±åº¦å¤ªå¤§å°±å®¹æ˜“å†™å¤ªå¤š .ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼å°±æ˜¯ç»å¯¹è·¯å¾„å¼•ç”¨ï¼Œè¿™é‡Œçš„ç»å¯¹è·¯å¾„æ˜¯æŒ‡ç›¸å¯¹é¡¹ç›®æ ¹ç›®å½•è€Œè¨€çš„ã€‚</p>
<h3 id="æ¨¡å—æœç´¢é¡ºåº"><a href="#æ¨¡å—æœç´¢é¡ºåº" class="headerlink" title="æ¨¡å—æœç´¢é¡ºåº"></a>æ¨¡å—æœç´¢é¡ºåº</h3><p>è‡ªå·±å†™çš„åŒ…åè‚¯å®šå¯èƒ½å’Œç¬¬ä¸‰æ–¹æˆ–è€…æ ‡å‡†åº“åŒåï¼Œä¸è¿‡è¿™ç§åŒåé€šå¸¸æ²¡æœ‰é—®é¢˜ã€‚å› ä¸º python ä¼šä¼˜å…ˆåœ¨å½“å‰ç›®å½•æœç´¢ç„¶ååœ¨ç¯å¢ƒå˜é‡çš„æœç´¢è·¯å¾„ï¼Œä¹‹åæ‰æ˜¯æ ‡å‡†åº“å’Œç¬¬ä¸‰æ–¹åŒ…ã€‚</p>
<p>è¿™ä¸ªå’Œ linux $PATH çš„ç¯å¢ƒå˜é‡ä¸€æ ·ï¼ŒæŒ‰ç…§é¡ºåºæ¥æœç´¢ã€‚ä¸€æ—¦å¯¼å…¥æ¯ä¸ªæ¨¡å—å°±æœ‰å…¨å±€çš„å‘½åç©ºé—´ï¼Œç¬¬äºŒæ¬¡å†æ¬¡åŠ è½½å°±ä¼šä½¿ç”¨ç¼“å­˜ã€‚</p>
<p>è¿™ä¸ªè·¯å¾„æœç´¢æ–¹å¼å’Œ nodejs æœ‰äº›åŒºåˆ«ï¼Œnodejs æ˜¯ä¸€æ—¦åŒåï¼Œä¼˜å…ˆæ ‡å‡†åº“ï¼Œå¦‚æœè‡ªå®šä¹‰ä¸€ä¸ª http æ¨¡å—ï¼Œé‚£ä¹ˆæ°¸è¿œä¸ä¼šè¢«åŠ è½½ã€‚</p>
<h3 id="pip-åŒ…ç®¡ç†å·¥å…·"><a href="#pip-åŒ…ç®¡ç†å·¥å…·" class="headerlink" title="pip åŒ…ç®¡ç†å·¥å…·"></a>pip åŒ…ç®¡ç†å·¥å…·</h3><p>åŒ…ç®¡ç†</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># å®‰è£…</span><br><span class="line"># æœ€æ–°ç‰ˆæœ¬</span><br><span class="line">pip install Django</span><br><span class="line"># æŒ‡å®šç‰ˆæœ¬å·</span><br><span class="line">pip install Django==2.0.0</span><br><span class="line"># æœ€å°ç‰ˆæœ¬</span><br><span class="line">pip install &#x27;Django&gt;=2.0.0&#x27;</span><br><span class="line"></span><br><span class="line"># å‡çº§åŒ…</span><br><span class="line">pip install --upgrade Django</span><br><span class="line"># å¸è½½åŒ…</span><br><span class="line">pip uninstall SomePackage</span><br><span class="line"># æœç´¢åŒ…</span><br><span class="line">pip search SomePackage</span><br><span class="line"># æ˜¾ç¤ºå®‰è£…åŒ…ä¿¡æ¯</span><br><span class="line">pip show</span><br><span class="line"># æŸ¥çœ‹æŒ‡å®šåŒ…çš„è¯¦ç»†ä¿¡æ¯</span><br><span class="line">pip show -f SomePackage</span><br><span class="line"># åˆ—å‡ºå·²å®‰è£…çš„åŒ…</span><br><span class="line">pip list</span><br><span class="line"># æŸ¥çœ‹å¯å‡çº§çš„åŒ…</span><br><span class="line">pip list -o</span><br></pre></td></tr></table></figure>
<p>åŒ…ä¾èµ–é”</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip freeze &gt; requirement.txt # é”ç‰ˆæœ¬</span><br><span class="line">pip install -r requirement.txt # æŒ‡å®šå®‰è£…ç‰ˆæœ¬</span><br><span class="line">pip install --user install black # å®‰è£…åˆ°ç”¨æˆ·çº§ç›®å½•</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>tech</category>
        <category>language</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ¨é¡¹ç›®ä¸­å¼•å…¥ MongoDB Sharding</title>
    <url>/post/dc97195f.html</url>
    <content><![CDATA[<p>ä¹‹å‰åœ¨é¡¹ç›®ä¸­è°ƒç ”å’Œå¼•å…¥äº† MongoDB Shardingï¼Œåœ¨æ­¤æ•´ç†ä¸€ä¸‹ç¬”è®°å’Œæ–‡æ¡£ã€‚</p>
<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><h2 id="åŸå› å’Œè§£å†³ç›®æ ‡"><a href="#åŸå› å’Œè§£å†³ç›®æ ‡" class="headerlink" title="åŸå› å’Œè§£å†³ç›®æ ‡"></a>åŸå› å’Œè§£å†³ç›®æ ‡</h2><p>ç›®å‰é¡¹ç›®åˆ©ç”¨ Mongo Replication ä¿è¯äº†æ•°æ®åº“ä¸­çš„å…¨éƒ¨æ•°æ®éƒ½ä¼šæœ‰å¤šä»½æ‹·è´ï¼Œä¿è¯äº†å†—ä½™å’Œé«˜å¯ç”¨ï¼Œä½†å•å°æœºå™¨çš„ CPUã€å†…å­˜ã€ç£ç›˜çš„é™åˆ¶ä¼šè¾¾åˆ°æ•°æ®åº“çš„ç“¶é¢ˆï¼Œå¤§éƒ¨åˆ†çš„è¯»å†™ç“¶é¢ˆä¹Ÿé˜»å¡åœ¨ä¸€å°æœåŠ¡å™¨ï¼Œå‡ºç°ç³»ç»Ÿæ— æ³•æ”¯æŒæ›´å¤šåååŠæµ·é‡æ•°æ®çš„å­˜å‚¨æ€§èƒ½ç­‰é—®é¢˜ã€‚ç”¨æˆ·çš„æ•°æ®é‡æ°¸è¿œåœ¨å¢åŠ ï¼Œè€Œæœºå™¨æå‡æ€§èƒ½æœ‰ç“¶é¢ˆã€‚å› æ­¤è€ƒè™‘å¼•å…¥ MongoDB Shardingï¼Œã€Œæ¨ªå‘ã€æ‰©å±•æ¥è§£å†³ç›®å‰é¡¹ç›®ä¸­é‡åˆ°çš„é—®é¢˜ã€‚MongoDB Sharding æœ¬è´¨æ˜¯ç”¨å¤šå°æœºå™¨æ¥å­˜å‚¨æ•°æ®ï¼Œæ¯ä¸ªæœºå™¨ä»…å­˜å‚¨éƒ¨åˆ†çš„æ•°æ®ã€‚</p>
<p>å®é™…ä¸Šç”Ÿäº§ç¯å¢ƒå·²ç»é‡åˆ°çš„é—®é¢˜ 1) ç”Ÿäº§ç¯å¢ƒå­˜åœ¨ã€‡ã€‡è¡¨ç”±äºä¸šåŠ¡é«˜é¢‘è¯»å†™äº§ç”Ÿç“¶é¢ˆ 2ï¼‰ã€‡ã€‡æ•°æ®å­˜å‚¨è¾¾åˆ° TB çº§åˆ«ï¼Œå­˜å‚¨é‡ä¸ºç™¾äº¿çº§åˆ«</p>
<p>Shardingçš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>è¯»å†™æ–¹é¢ï¼šshardingå°†è¯»å†™è´Ÿè½½å‡åŒ€åˆ°å„ä¸ªshardï¼Œå½“æœºå™¨çš„è¯»å†™é‡è¾¾åˆ°å½“å‰éƒ¨ç½²æ¨¡å¼çš„ç“¶é¢ˆæ—¶å¯ä»¥é€šè¿‡æ°´å¹³æ‰©å±•Shardæ¥è´Ÿè½½è¯»å†™ï¼›</li>
<li>æ‰©å®¹æ–¹é¢ï¼šæ¯ä¸ªShardä¿å­˜ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå¯ä»¥é€šè¿‡å¢åŠ Shardæ¥æ‰©å®¹ï¼Œç†è®ºä¸Šmongoå¯ä»¥åˆ©ç”¨æ‰©å±•shardå­˜å‚¨æ— é™çš„æ•°æ®ï¼›<a href="https://www.mongodb.com/docs/manual/core/sharded-cluster-requirements/">Shard key &amp; max size of collection</a></li>
<li>é«˜å¯ç”¨æ–¹é¢ï¼šå³ä¾¿æŸä¸ªShardä¸å¯ç”¨äº†ï¼Œæ•´ä¸ªé›†ç¾¤ä¹Ÿå¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ï¼›<br>Mongo Shardæœ¬èº«ä¸æ”¯æŒå¤‡ä»½ï¼Œå› æ­¤è€ƒè™‘ä½¿ç”¨Replica Setä¾†æ­å»º MongoDB Sharded Clusterï¼Œå³æ¯ä¸ªShardéƒ¨ç½²ä¸ºReplica Setã€‚<span id="more"></span></li>
</ul>
<p>ä¼˜åŒ–çš„ç›®æ ‡ï¼š</p>
<ul>
<li>åˆ©ç”¨å¤šå°æœºå™¨åˆ†æ‹…å•æœºmongoçš„è¯»å†™ã€å­˜å‚¨å‹åŠ›ï¼›ï¼ˆæ€§èƒ½ï¼‰</li>
<li>æ¯ä¸ªShard ä¸º Replica Setæ¨¡å¼ï¼Œåˆ©ç”¨å†—ä½™ç»´æŒå¯é æ€§ï¼›ï¼ˆå¯ç”¨æ€§ã€å¯é æ€§ï¼‰</li>
<li>é¡¹ç›®ä¸Šåº”ç”¨ä¸åŒçš„çº¿ä¸Šç¯å¢ƒï¼ˆä¸šåŠ¡æ­¤å¤„ç•¥ï¼‰</li>
</ul>
<h2 id="Sharding-Strategy"><a href="#Sharding-Strategy" class="headerlink" title="Sharding Strategy"></a>Sharding Strategy</h2><p>Mongo Shardæ–¹æ¡ˆæœ€é‡è¦çš„éƒ¨åˆ†åœ¨äº Shard Key çš„é€‰æ‹©ï¼Œä¸å­˜åœ¨å®Œç¾çš„ shard keyï¼Œåªæœ‰é€‰æ‹© shard key æ—¶åº”å½“æ³¨æ„å’Œè€ƒè™‘çš„è¦ç´ ã€‚ä¸ä¼šå‡ºç°ä¸€ç§ shard key å¯ä»¥æ»¡è¶³æ‰€æœ‰çš„å¢åˆ æ”¹æŸ¥æ“ä½œã€‚è¿™éœ€è¦ä»åº”ç”¨åœºæ™¯ä¸­æŠ½è±¡å‡ºç”¨æ¥é€‰æ‹© shard key çš„å…ƒç´ ï¼ŒåŒ…æ‹¬å„ä¸ªæ•°æ®å­—æ®µçš„æ„ä¹‰ï¼Œä½¿ç”¨çš„ä¸šåŠ¡ä»·å€¼ä»¥åŠæœªæ¥ä¸šåŠ¡çš„å¢é•¿ç‚¹ã€‚å¦‚æœåœ¨ä¸€å¼€å§‹ shard key çš„é€‰æ‹©å‡ºç°é”™è¯¯ï¼Œé‚£ä¹ˆåœ¨æ¥ä¸‹æ¥çš„åº”ç”¨è¿‡ç¨‹ä¸­æƒ³è¦æ”¹å˜ shard key æ˜¯ä¸€ä»¶æå…¶ç¹ççš„è¿‡ç¨‹ã€‚ï¼ˆå³ä½¿ Mongoæ”¯æŒreshard collectionã€redefine shardkeyï¼‰</p>
<p>Mongo shard çš„å­˜å‚¨çš„æœ€å°çš„å•å…ƒä¸º chunkï¼Œå³ä¸€ä¸ª shard ä¸­ä¼šåˆ†å¸ƒå¤šä¸ª chunkï¼Œæ¯ä¸€ä¸ª chunk éƒ½åŒ…å«å®ƒçš„ä¸Šä¸‹å±Šï¼Œåœ¨ mongos ä¸Šä½¿ç”¨ db.stats() å¯ä»¥æŸ¥çœ‹ä¸€ä¸ª collection åˆ†å¸ƒåœ¨å“ªäº› shard ä¸Šï¼Œä¸€ä¸ª shard ä¸ŠåŒ…å«ä¸€ä¸ª collection çš„é‚£äº› chunkï¼Œä»¥åŠä¸€ä¸ª chunk çš„èŒƒå›´ã€‚</p>
<p>å…¶ä¸­ Shard çš„ä¸Šä¸‹å±Šçš„å«ä¹‰å’Œé€‰æ‹© Hashing Key è¿˜æ˜¯ Range Key ç›¸å…³ï¼Œè‹¥é€‰æ‹©çš„æ˜¯ Hashing Keyï¼Œé‚£ä¹ˆ chunk çš„ä¸Šä¸‹å±Šä¸º Key Hash åçš„å€¼ï¼ŒæŒ‰ç…§ Range Keyï¼Œé‚£ä¹ˆ chunk çš„ä¸Šä¸‹å±Šä¸º key çš„èŒƒå›´ã€‚</p>
<p>ä»¥ Hashing Key ä¸¾ä¾‹ï¼Œid&#x3D;1 å’Œ id&#x3D;1000 hash åå‘é€åˆ°åŒä¸€ä¸ª Shardï¼ŒHash åçš„ Key çš„èŒƒå›´åˆå±äºåŒä¸€ä¸ª chunkï¼Œé‚£ä¹ˆ id&#x3D;1 å’Œ id&#x3D;1000 çš„æ•°æ®ä¼šå­˜å‚¨åˆ°åŒä¸€ä¸ª chunkã€‚è‹¥ id&#x3D;1 çš„æ•°æ®é‡ä¸€ç›´åœ¨å¢é•¿ï¼Œè¿™ä¸ª chunk è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œä¼šæ ¹æ®chunk ä¸Šä¸‹å±Šå†…çš„èŒƒå›´åˆ†è£‚æˆä¸¤ä¸ª chunkï¼›è‹¥ id&#x3D;1 çš„æ•°æ®å¢é•¿åˆ° chunk é˜ˆå€¼ï¼ˆ MongoDB å¯é…ç½®ï¼‰æ— æ³•å†åˆ†è£‚ï¼Œè¿™ä¸ª chunk å°±è¿›åŒ–ä¸º jumbo chunkã€‚</p>
<p>MongoDBåˆ†ç‰‡é›†ç¾¤æ”¯æŒçš„åˆ†ç‰‡ç­–ç•¥ï¼š</p>
<ol>
<li>èŒƒå›´åˆ†ç‰‡ï¼Œæ”¯æŒåŸºäºShard Keyçš„èŒƒå›´æŸ¥è¯¢ï¼›</li>
<li>å“ˆå¸Œåˆ†ç‰‡ï¼Œèƒ½å¤Ÿå°†å†™å…¥å‡è¡¡åˆ†å¸ƒåˆ°å„ä¸ªshardï¼›</li>
<li>Tag aware shardingï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€äº›chunkçš„åˆ†å¸ƒè§„åˆ™ï¼›å°†ä¸€æ®µç‰‡é”®èŒƒå›´ä¸ä¸€ä¸ªæ ‡è®°ç›¸å…³è”.æ¯ä¸ªæŒ‡å®šçš„ç‰‡é”®èŒƒå›´åªèƒ½ä¸ä¸€ä¸ªæ ‡è®°ç›¸å…³è”,å®šä¹‰çš„èŒƒå›´ä¸èƒ½é‡å ,ä¹Ÿä¸èƒ½å¯¹åŒä¸€ä¸ªç‰‡é”®èŒƒå›´å®šä¹‰ä¸¤æ¬¡ï¼›</li>
</ol>
<p>ä¸ºä¸€å®šèŒƒå›´å†…çš„ç‰‡é”®åˆ¶å®šä¸€ä¸ªTag(Zone)ï¼Œç„¶åå†å°†ä¸€äº›åˆ†ç‰‡åŠ å…¥åˆ°è¿™ä¸ªTag(Zone)ä¸­ï¼Œäºæ˜¯è¿™ä¸€èŒƒå›´å†…çš„æ•°æ®æœ€ç»ˆå°±å°†å­˜å‚¨åœ¨è¿™ä¸ªTag(Zone)ä¸­çš„åˆ†ç‰‡ä¸Šã€‚Tag(Zone)æŒ‡å®šçš„èŒƒå›´ä¸èƒ½æœ‰äº¤é›†ã€‚<br>åˆ†ç‰‡å†…çš„å‡è¡¡å™¨åœ¨åˆ†ç‰‡é—´ç§»åŠ¨Chunkæ—¶ï¼ŒèŒƒå›´å†…çš„æ•°æ®ä»…ä¼šåœ¨åŒä¸€Tag(Zone)çš„åˆ†ç‰‡é—´ç§»åŠ¨ï¼Œä»¥ä¿è¯åˆ†å¸ƒçš„åˆæ³•æ€§ï¼Œå¯¹äºé‚£äº›æ²¡æœ‰è¢«Tag(Zone)é™åˆ¶çš„Chunkï¼Œåˆ™å¯èƒ½å‡ºç°åœ¨ä»»æ„åˆ†ç‰‡ä¸Šã€‚</p>
<ol start="4">
<li>å¤åˆåˆ†ç‰‡ï¼šShard key can contain at most one â€˜hashedâ€™ field, and&#x2F;or multiple numerical fields set to a value of 1ï¼›å¤åˆé”®å¯ä»¥ä½¿ç”¨è‡³å¤šä¸€ä¸ªhashed filedæˆ–&#x2F;å’Œå¤šä¸ªrange fieldæ¥æ„æˆå¤åˆé”®ï¼Œå¤åˆé”®åŒæ—¶å†³å®šäº†collectionçš„documentåœ¨shardä¸Šçš„åˆ†å¸ƒï¼Œæ¯”å¦‚{id:â€hashedâ€, time: 1}ï¼Œé‚£ä¹ˆå­˜åœ¨ä¸€ä¸ªç§Ÿæˆ·çš„æ•°æ®å¹¶ä¸æ€»æ˜¯åˆ†å¸ƒåœ¨ä¸€ä¸ªshardä¸Šã€‚ä»¥å“ˆå¸Œæˆ–èŒƒå›´é”®ä½œä¸ºå¤åˆç‰‡é”®çš„å‰ç¼€ï¼ˆå³ç¬¬ä¸€ä¸ªå­—æ®µçš„åˆ†ç‰‡æ–¹å¼ï¼‰å­˜åœ¨åŒºåˆ«ï¼Œmongodbå®˜æ–¹æä¾›äº†å¯¹äºå“ˆå¸Œ &#x2F; èŒƒå›´ &#x2F; å¤åˆç‰‡é”®åœ¨åˆ†ç‰‡ä¸€ä¸ªç©ºçš„collectionçš„åˆå§‹åŒ–é€»è¾‘ï¼Œhashed-shardingï¼›</li>
</ol>
<p>å¦‚æœshard keyä¸ºä¸€ä¸ªé€’å¢çš„å­—æ®µï¼Œæ¯”å¦‚_id æˆ–è€…æ—¶é—´æˆ³ï¼Œèµ„æºå”¯ä¸€çš„int idé€’å¢åˆ†é…ï¼‰é‚£å°±ä¸é€‚åˆä½¿ç”¨èŒƒå›´åˆ†ç‰‡çš„æ–¹å¼æ¥ä½œä¸ºåˆ†ç‰‡ç­–ç•¥ï¼Œè¿™æ ·ä¼šé€ æˆå†™çƒ­ç‚¹ï¼Œå³æ–°å¢çš„æ•°æ®åªä¼šå¾€è¦†ç›–æœ€å¤§å€¼çš„shardä¸­å†™å…¥ï¼›</p>
<p>å¦‚ä½•é€‰æ‹©ä¸€ä¸ªç‰‡é”®ç±»å‹ï¼šä¸€ä¸ªé›†åˆåŒ…å«ç›¸åŒç±»å‹çš„èµ„æºåˆ—è¡¨ï¼Œå¹¶å’Œå…¶ä»–èµ„æºéš”ç¦»</p>
<p>æ˜¯å¦å¯ç”¨Sharding<br>1.ï¼ˆä¸šåŠ¡ä¸Šï¼‰å¤šç§Ÿæˆ·ï¼ˆç•¥ï¼‰<br>2.å•è¡¨çš„æ•°æ®é‡æ˜¯å¦å¾ˆå¤§ï¼Œèƒ½é€šè¿‡ä¸åŒçš„æœºå™¨æ¥åˆ†æ‹…æ•°æ®å­˜å‚¨ï¼›<br>3.å•è¡¨çš„è¯»å†™æ˜¯å¦å¾ˆé¢‘ç¹ï¼Œèƒ½é€šè¿‡å°†è¯»å†™åˆ†æ‹…åˆ°ä¸åŒçš„æœºå™¨æ¥ç¼“è§£å‹åŠ›ï¼›<br>4.æå‰è¯„ä¼°ä¸šåŠ¡å¢é•¿é‡å’Œè§„æ¨¡åˆ¤æ–­æ˜¯å¦éœ€è¦å¼€å¯shardingï¼›</p>
<p>Shard Keyé€‰æ‹©çš„åŸåˆ™</p>
<ul>
<li>keyåˆ†å¸ƒè¶³å¤Ÿç¦»æ•£ï¼ˆsufficient cardinalityï¼‰ï¼›</li>
<li>å†™è¯·æ±‚å‡åŒ€åˆ†å¸ƒï¼ˆevenly distributed writeï¼‰ï¼›</li>
<li>å°½é‡é¿å…scatter-gatheræŸ¥è¯¢ï¼ˆtargeted readï¼‰ï¼›</li>
</ul>
<p>ç‰‡é”®çš„é€‰æ‹©ä¹Ÿæœ‰è‰¯å¥½çš„è®¾è®¡æ¨¡å¼å¯ä»¥éµå®ˆï¼š<br>â€’ä½¿ç”¨ä¸€ä¸ªåŸºäºåœ¨å¤§å¤šæ•°æŸ¥è¯¢ä¸­ç»å¸¸å‡ºç°çš„å­—æ®µçš„å“ˆå¸Œç‰‡é”®ï¼›æ¯”å¦‚å¤šç§Ÿæˆ·è¡¨ç§Ÿæˆ· IDã€å‡ºç°åœ¨ç´¢å¼•ä¸­çš„å­—æ®µï¼›<br>â€’å¤åˆç‰‡é”®ï¼Œç”±ä¸€ä¸ªä½åŸºæ•°ï¼ˆâ€œåšå®çš„â€ï¼‰ç»„æˆç¬¬ä¸€éƒ¨åˆ†ï¼Œé«˜åŸºæ•°ç»„æˆç¬¬äºŒä¸ªéƒ¨åˆ†ï¼Œè€Œä¸”ç»å¸¸æ˜¯ä¸€ä¸ªå•è°ƒé€’å¢çš„é”®ã€‚å¦‚æœåœ¨ç¬¬ä¸€éƒ¨åˆ†æœ‰è¶³å¤Ÿæ•°é‡çš„å”¯ä¸€å€¼ï¼ˆè‡³å°‘æ˜¯åˆ†ç‰‡æ•°çš„ä¸¤å€ï¼‰ï¼Œå°†ä¼šè·å¾—å¾ˆå¥½çš„å†™å…¥å’Œè¯»å–åˆ†å¸ƒã€‚</p>
<p>åœ¨ä¸šåŠ¡ä¸Šå¯¹ Shard key çš„é€‰æ‹©æ¨èï¼ˆæ­¤å¤„ä¸šåŠ¡æ˜¯èµ„æºå±äºå¤šä¸ªç§Ÿæˆ·ä¸”æ²¡æœ‰å…¨å±€ä½¿ç”¨çš„é—®é¢˜ï¼‰</p>
<ol>
<li>ç§Ÿæˆ·è¡¨ä¸åˆ†ç‰‡ï¼›</li>
<li>å­˜åœ¨ç§Ÿæˆ·IDçš„è¡¨ä½¿ç”¨ç§Ÿæˆ·IDä½œä¸ºåˆ†ç‰‡é”®ï¼Œä½¿ç”¨hashåˆ†ç‰‡ï¼›ä¸ä½¿ç”¨èŒƒå›´åˆ†ç‰‡çš„åŸå› åœ¨äºæ–°å¢ç§Ÿæˆ·æ•°æ®ä¼šæ ¹æ®shardingè§„åˆ™è½åˆ°åŒä¸€ä¸ªshardä¸­ï¼Œé€ æˆå†™çƒ­ç‚¹ï¼Œchunkæ•°é‡å¢å¤šå¯¼è‡´balanceræœºåˆ¶è¿ç§»chunkï¼›</li>
<li>Shard keyå¿…é¡»å­˜åœ¨ç´¢å¼•æˆ–è€…åœ¨å¤åˆç´¢å¼•çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼›</li>
</ol>
<ul>
<li>è‹¥é›†åˆä¸ºç©ºï¼ŒshardCollectionæ“ä½œä¼šè‡ªåŠ¨åˆ›å»ºç´¢å¼•</li>
<li>è‹¥é›†åˆä¸ä¸ºç©ºï¼ŒshardCollectionæ“ä½œå‰éœ€è¦shard keyå­˜åœ¨äºç´¢å¼•ä¸­</li>
<li>è¿ç§»æ—¶éœ€è¦å…ˆè¿›è¡Œæ·»åŠ ç´¢å¼•æ“ä½œå†è¿›è¡ŒshardCollectionï¼Œä¿æŒå„ä¸ªç¯å¢ƒçš„ç´¢å¼•ç»Ÿä¸€ã€‚</li>
</ul>
<ol start="4">
<li>å•ç§Ÿæˆ·ä¸‹éƒ¨åˆ†èµ„æºæ•°æ®é‡ä»å¾ˆå¤§ï¼Œéœ€è¦é€‰æ‹©ä¸€ä¸ªèƒ½å¤Ÿè¢«å†åˆ†åˆ°å°èŒƒå›´çš„ç‰‡é”®ã€‚å¦‚æœä½ ä¸è¿™æ ·åšï¼ŒMongoDBå°†ä¼šä¸å¾—ä¸åœ¨ä¸€ä¸ªå•ä¸€çš„æ•°æ®æ®µä¸­æ”¾ç½®å¤ªå¤šæ–‡æ¡£ã€‚å½“è¿™ä»¶äº‹æƒ…å‘ç”Ÿæ—¶ï¼Œæœ€åä¼šåœ¨é›†ç¾¤ä¸­äº§ç”Ÿâ€œåºå¤§çš„â€æ•°æ®æ®µï¼Œè¿™å°†å½±å“åˆ°é›†ç¾¤çš„æ€§èƒ½ä»¥åŠå¯ç®¡ç†æ€§ã€‚<br> â€’ ç§Ÿæˆ·çº§åˆ«å­˜åœ¨éƒ¨åˆ†ç§Ÿæˆ·çš„ä¸šåŠ¡é‡å¤§ï¼Œéœ€è¦è®©è¿™äº›å¤§ç§Ÿæˆ·æ‰€åœ¨çš„ mongod ä¸Šï¼Œç§Ÿæˆ·æ€»æ•°å°‘ä¸€äº›ï¼Œå¯ä»¥åˆ©ç”¨mongo shardTag + balanceræœºåˆ¶æ¥åŠ¨æ€åˆ†é…ï¼ˆæ— éœ€ä»£ç æ”¹é€ ï¼‰ï¼›<br> â€’ å•ç§Ÿæˆ·ä¸‹çš„èµ„æºï¼Œæ­¤æ—¶éœ€è¦ç»“åˆä¸šåŠ¡è€ƒè™‘ç§Ÿæˆ·Id + () å¤šå­—æ®µç‰‡å»º å˜æ›´ç‰‡é”®ç»´åº¦æˆ–è€…è€ƒè™‘å¤åˆç‰‡é”®ï¼Œéœ€è¦æ”¹é€ ä»£ç ï¼›</li>
<li>æ²¡æœ‰ç§Ÿæˆ·IDçš„è¡¨æ ¹æ®ä¸šåŠ¡å’Œæ”¹é€ ä»£ç ï¼ŒåŸåˆ™ä¸€è‡´ã€‚ä¿è¯æ•°æ®åº“æ“ä½œå’ŒShard keyè€¦åˆï¼›</li>
<li>Shard Keyå¿…é¡»å­˜åœ¨äºç´¢å¼•ä¸­ï¼›</li>
<li>æ³¨æ„èŒƒå›´åˆ†ç‰‡å’Œå“ˆå¸Œåˆ†ç‰‡æ— æ³•è§£å†³çš„é—®é¢˜ï¼š</li>
</ol>
<ul>
<li>Shard Keyçš„å–å€¼èŒƒå›´å¤ªå°ï¼Œä¾‹å¦‚å°†æ•°æ®ä¸­å¿ƒä½œä¸ºShard Keyï¼Œç”±äºæ•°æ®ä¸­å¿ƒé€šå¸¸ä¸å¤šï¼Œåˆ™åˆ†ç‰‡æ•ˆæœä¸å¥½ã€‚</li>
<li>Shard Keyä¸­æŸä¸ªå€¼çš„æ–‡æ¡£ç‰¹åˆ«å¤šï¼Œä¼šå¯¼è‡´å•ä¸ªchunkç‰¹åˆ«å¤§ï¼ˆå³ jumbo chunkï¼‰ï¼Œä¼šå½±å“chunkè¿ç§»åŠè´Ÿè½½å‡è¡¡ã€‚</li>
<li>æ ¹æ®éShard Keyè¿›è¡ŒæŸ¥è¯¢ã€æ›´æ–°æ“ä½œéƒ½ä¼šå˜æˆscatter-gatheræŸ¥è¯¢ï¼Œå½±å“æ•ˆç‡ã€‚</li>
</ul>
<ol start="8">
<li>mongo &gt;&#x3D; 4.4, æ”¯æŒducumentåœ¨sharded collectionä¸­çš„shard key &#x3D; null</li>
<li>mongoDb query.explain() æœ‰ä¸¤ä¸ªSTAGEå’Œshardç›¸å…³ï¼ŒSHARD_MERGE å’Œ SHARDING_FILTERï¼ŒSHARD_MERGEè¡¨ç¤ºä»å„ä¸ªShardä¸­åˆå¹¶æ•°æ®ï¼ŒSHARDING_FILTERè¡¨ç¤ºè¿‡æ»¤æ–‡æ¡£ä¸­çš„å­¤ç«‹æ–‡æ¡£ï¼›</li>
</ol>
<h3 id="shard-keyå¯¹æ“ä½œçš„å½±å“"><a href="#shard-keyå¯¹æ“ä½œçš„å½±å“" class="headerlink" title="shard keyå¯¹æ“ä½œçš„å½±å“"></a>shard keyå¯¹æ“ä½œçš„å½±å“</h3><p><strong>æŸ¥è¯¢è¯·æ±‚</strong><br>æŸ¥è¯¢è¯·æ±‚ä¸åŒ…å«shard keyï¼Œåˆ™å¿…é¡»å°†æŸ¥è¯¢åˆ†å‘åˆ°æ‰€æœ‰çš„shardï¼Œç„¶ååˆå¹¶æŸ¥è¯¢ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼›æŸ¥è¯¢è¯·æ±‚åŒ…å«shard keyï¼Œåˆ™ç›´æ¥æ ¹æ®shard keyè®¡ç®—å‡ºéœ€è¦æŸ¥è¯¢çš„chunkï¼Œå‘å¯¹åº”çš„shardå‘é€æŸ¥è¯¢è¯·æ±‚<br><strong>å†™è¯·æ±‚</strong><br>å†™æ“ä½œå¿…é¡»åŒ…å«shard keyï¼Œmongosæ ¹æ®shard keyç®—å‡ºæ–‡æ¡£åº”è¯¥å­˜å‚¨åˆ°å“ªä¸ªchunkï¼Œç„¶åå°†å†™è¯·æ±‚å‘é€åˆ°chunkæ‰€åœ¨çš„shardã€‚<br><strong>æ›´æ–°&#x2F;åˆ é™¤è¯·æ±‚</strong><br>æ›´æ–°ã€åˆ é™¤è¯·æ±‚çš„æŸ¥è¯¢æ¡ä»¶å¿…é¡»åŒ…å«shard keyæˆ–è€…_idï¼Œå¦‚æœæ˜¯åŒ…å«shard keyï¼Œåˆ™ç›´æ¥è·¯ç”±åˆ°æŒ‡å®šçš„chunkï¼Œå¦‚æœåªåŒ…å«_idï¼Œåˆ™éœ€å°†è¯·æ±‚å‘é€è‡³æ‰€æœ‰çš„shardã€‚</p>
<p><strong>ä»£ç æ”¹é€ </strong></p>
<ul>
<li>æ‰€æœ‰æŸ¥è¯¢ã€ä¿®æ”¹ã€åˆ é™¤æ–¹æ³•ç¡®è®¤æ˜¯å¦å¸¦ä¸ŠShard Keyï¼›ï¼ˆä¸šåŠ¡ä¸Šå·²ç»ç”¨å¤šç§Ÿæˆ·ç¡®ä¿ï¼‰</li>
<li>æ‰€æœ‰çš„updateOne()å’ŒdeleteOne()æ“ä½œï¼Œå³æŒ‡å®šäº†multi: false æˆ–è€… One() çš„æ“ä½œï¼Œqueryä¸­éœ€è¦åŒ…å«Shard Keyæˆ–è€…_idå±æ€§ï¼Œå¦åˆ™æ“ä½œä¼šè¿”å›errorï¼›</li>
<li>findOneAndUpdate() æ“ä½œéœ€è¦åœ¨æ¡ä»¶ä¸­ä½¿ç”¨Shard keyå’ŒæŒ‡å®šçš„å­—æ®µç›¸ç­‰ï¼Œæ¯”å¦‚{ key: value } { key: { $eq: value } }</li>
<li>å¯¹äºcount()ã€ä¸å¸¦ä»»ä½•æŸ¥è¯¢æ¡ä»¶ã€‘ æ›¿æ¢æˆaggregateçš„count pipelineï¼›</li>
</ul>
<h2 id="éƒ¨ç½²å»ºè®®"><a href="#éƒ¨ç½²å»ºè®®" class="headerlink" title="éƒ¨ç½²å»ºè®®"></a>éƒ¨ç½²å»ºè®®</h2><p>Sharding æœºåˆ¶æœ¬èº«ä¸è´Ÿè´£å¤‡ä»½ï¼Œå»ºè®®ä½¿ç”¨Replica Set ä¾†æ­å»º MongoDB Sharded Clusterã€‚æ¯ä¸ªShardä½¿ç”¨PSSæ¨¡å¼ + å¤šå¯ç”¨åŒºæ•°æ®åº“å®ä¾‹éƒ¨ç½²ã€‚</p>
<p>å¤šå¯ç”¨åŒºæ•°æ®åº“å®ä¾‹éƒ¨ç½²ï¼šæ¯ä¸ªshardéƒ¨ç½²ä¸ºReplica Setï¼Œå‚è€ƒ<a href="https://www.mongodb.com/docs/manual/tutorial/force-member-to-be-primary/">Force Member To Be Primary</a>ï¼Œå¯ä»¥å°†å½“å‰å¯ç”¨åŒºçš„mongodæŒ‡å®šä¸ºPrimaryï¼Œå°†Replica Seté›†ç¾¤åˆ†å¸ƒåˆ°ä¸åŒçš„å¯ç”¨åŒºï¼ˆZoneï¼‰ä¸Šã€‚å®ä¾‹çš„å¤šå¯ç”¨åŒºéƒ¨ç½²æä¾›äº†é«˜å¯ç”¨æ€§å’Œæ•…éšœè½¬ç§»æ”¯æŒã€‚</p>
<p>shardç›¸å…³æ·»åŠ shardï¼Œblancerï¼Œzoneså‘½ä»¤å¯å‚è€ƒ<a href="https://www.mongodb.com/docs/manual/sharding/">MongoDb Shard</a></p>
<h2 id="å®¹é‡è¯„ä¼°"><a href="#å®¹é‡è¯„ä¼°" class="headerlink" title="å®¹é‡è¯„ä¼°"></a>å®¹é‡è¯„ä¼°</h2><p>å®¹é‡è¦æå‰åšå¥½è§„åˆ’ï¼Œä½†æ˜¯å®¹é‡çš„è§„åˆ’éœ€è¦çŸ¥é“ä¸šåŠ¡çš„æ‰©å¼ é€Ÿåº¦ï¼Œæ‰©å¼ é€Ÿåº¦è¿™ç§äº‹æƒ…åˆä¸æ˜¯æå‰èƒ½è®¡åˆ’å¥½çš„ã€‚ä½†æ˜¯è‡³å°‘å¯ä»¥å¯¹ç»´æŠ¤çš„ç³»ç»Ÿå»ºç«‹ä¸€ä¸ªæ¨¡å‹ï¼ŒçŸ¥é“å¤šå°‘æœºå™¨ï¼Œå¤šå°‘èµ„æºï¼Œèƒ½å®¹çº³å¤šå°‘å®¹é‡ã€‚ä»¥ä¸‹ç»™å‡ºçš„å¯¹äºmongo shardçš„å®¹é‡å»ºè®®ï¼š</p>
<ul>
<li><p>åˆ†ç‰‡&amp; mongos æ•°é‡<br>æ•°é‡ä¸Šæ²¡æœ‰æ²¡æœ‰åˆ†ç‰‡é™åˆ¶ï¼›åˆ†ç‰‡æ•°è‡³å°‘å¤§äº1ï¼Œä»¥æ”¯æŒæ•°æ®åˆ†ç‰‡åŠŸèƒ½ï¼›å¯ä»¥æ ¹æ®ä¸šåŠ¡æµé‡å³°å€¼qpsï¼Œé¢„è®¡éœ€è¦å¤šå°‘ä¸ªåˆ†ç‰‡é‡ã€‚<br>ä¾‹å¦‚ä¸€ä¸ªshardçš„æœ€å¤§QPSä¸ºMï¼Œä¸€ä¸ªmongosçš„æœ€å¤§QPSä¸ºMsï¼Œä¸šåŠ¡éœ€è¦çš„æ€»QPSä¸ºQï¼Œé‚£ä¹ˆä¸šåŠ¡éœ€è¦çš„shardå’Œmongosæ•°é‡æŒ‰ç…§ä»¥ä¸‹å…¬å¼è®¡ç®—ï¼š<br>numberOfShards &#x3D; Q&#x2F;M&#x2F;0.75 ï¼ˆå‡è®¾è´Ÿè½½æ°´ä½çº¿ä¸º75%ï¼‰<br>numberOfMongos &#x3D; Q&#x2F;Ms&#x2F;0.75</p>
</li>
<li><p>shard æœºå™¨å†…å­˜ã€ç£ç›˜è¯„ä¼°<br>  mongodb å¯¹å†…å­˜æ¶ˆè€—ä¸é«˜ï¼Œç™¾äº¿çº§ä»¥ä¸Š mongodb é›†ç¾¤æœ€å¤§å†…å­˜åŸºæœ¬ä¸Šéƒ½æ˜¯ 64Gbã€‚<br>  æ ¹æ®æ•°æ®åº“ç£ç›˜æ¶ˆè€—é‡è¯„ä¼°åˆ†ç‰‡ï¼Œç†æƒ³æƒ…å†µæ˜¯æ€»é‡ m å‡åŒ€çš„åˆ†å¸ƒåˆ° n ä¸ªåˆ†ç‰‡ä¸Šï¼Œn &#x2F; m å¾—å‡ºé¢„è®¡æ¯ä¸ªåˆ†ç‰‡ç£ç›˜çš„æ¶ˆè€—ï¼›</p>
</li>
<li><p>config &amp; mongos æœºå™¨å†…å­˜ã€ç£ç›˜è¯„ä¼°<br>ç”±äº config server åªä¸»è¦å­˜å‚¨è·¯ç”±ç›¸å…³å…ƒæ•°æ®ï¼Œå› æ­¤å¯¹ç£ç›˜ã€CUPã€MEM æ¶ˆè€—éƒ½å¾ˆä½ï¼›mongos ä»£ç†åªåšè·¯ç”±è½¬å‘åªæ¶ˆè€— CPUï¼Œå› æ­¤å¯¹å†…å­˜å’Œç£ç›˜æ¶ˆè€—éƒ½ä¸é«˜ã€‚<br>éƒ¨ç½²æ–¹å¼</p>
</li>
</ul>
<h2 id="Upgrade"><a href="#Upgrade" class="headerlink" title="Upgrade"></a>Upgrade</h2><p>å‚è€ƒ <a href="https://www.mongodb.com/docs/manual/tutorial/convert-replica-set-to-replicated-shard-cluster/">convert-replica-set-to-replicated-shard-cluster</a></p>
<p>å¼•å…¥Mongo Shardå¯¹äºè¿ç»´çš„æŒ‘æˆ˜åœ¨äºDay1å’ŒDay2+çš„å˜åŒ–ï¼ŒDay1åœ¨äºéƒ¨ç½²ç¯å¢ƒå¼•å…¥Mongo Shardã€‚Day2åˆ™è¦è€ƒè™‘ä¸»è¦è¦å…³æ³¨ç¨³å®šæ€§ã€‚å¦‚ä½•åˆç†åœ°å¯¹çº¿ä¸Šmongodbè¿›è¡Œæ¨ªå‘åœ°æ‰©å±•ï¼Œéœ€è¦ç»“åˆçº¿ä¸Šä¸šåŠ¡é‡çš„ç›‘æ§æ¥å¯¹æ•°æ®åˆ†ç‰‡ï¼Œæ¯”å¦‚å½“å¯¹ä¸€ä¸ªå·²ç»å­˜åœ¨çš„é›†åˆåšåˆ†ç‰‡æ—¶ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šèŠ±è´¹ä¸€äº›æ—¶é—´ã€‚åˆ†ç‰‡æ˜¯åœ¨åå°è¿›è¡Œçš„ï¼Œæ‰€ä»¥å…¶ä»–æ“ä½œä¸ä¼šè¢«æ˜æ˜¾çš„å—åˆ°å½±å“ã€‚æ— è®ºå¦‚ä½•ï¼Œå°†ä¸€ä¸ªå¤§çš„é›†åˆä¸­çš„æ•°æ®è¿›è¡Œè¿ç§»&#x2F;å¹³è¡¡ä¼šå ç”¨å¾ˆå¤šæ—¶é—´ã€‚ä¾‹å¦‚ä¸€ä¸ªæ‹¥æœ‰10ä¸ªshardçš„ç³»ç»Ÿä¸­ï¼Œé›†åˆä¸­90%çš„æ•°æ®éœ€è¦è¿ç§»åˆ°å…¶ä»–åœ°æ–¹ä»¥è¾¾åˆ°å¹³è¡¡ï¼›ä¹Ÿéœ€è¦è€ƒè™‘å¦‚ä½•é‡åŒ–ã€Œå¢åŠ ä¸€ä¸ªShardã€ï¼Œæœªæ¥ä¹Ÿéœ€è¦è€ƒè™‘è‡ªåŠ¨æ‰©å±•shardçš„æ–¹æ¡ˆã€‚</p>
<h2 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h2><p>åœ¨ä¸€ä¸ª shard server å†…éƒ¨ï¼ŒMongoDB è¿˜æ˜¯ä¼šæŠŠæ•°æ®åˆ†ä¸º chunks, æ¯ä¸ª chunk ä»£è¡¨è¿™ä¸ª shard server å†…éƒ¨ä¸€éƒ¨åˆ†æ•°æ®ã€‚å½“ä¸€ä¸ª chunk çš„å¤§å°è¶…è¿‡é…ç½®ä¸­çš„ chunk size æ—¶ï¼ŒMongoDB çš„åå°è¿›ç¨‹ä¼šæŠŠè¿™ä¸ª chunk åˆ‡åˆ†æˆæ›´å°çš„ chunkï¼Œä»è€Œé¿å… chunk è¿‡å¤§çš„æƒ…å†µ.</p>
<p>Balancing åœ¨ MongoDB ä¸­ï¼Œbalancer æ˜¯ä¸€ä¸ªåå°è¿›ç¨‹ï¼Œè´Ÿè´£ chunk çš„è¿ç§»ï¼Œä»è€Œå‡è¡¡å„ä¸ª shard server çš„è´Ÿè½½ï¼Œç³»ç»Ÿåˆå§‹ 1 ä¸ª chunkï¼Œchunk size é»˜è®¤å€¼ 64M, ç”Ÿäº§åº“ä¸Šé€‰æ‹©é€‚åˆä¸šåŠ¡çš„ chunk sizeæ˜¯æœ€å¥½çš„ï¼Œå¦‚æœå•ä½æ—¶é—´å†…çš„å­˜å‚¨éœ€æ±‚å¾ˆå¤§ï¼Œè®¾ç½®æ›´å¤§çš„ chunkã€‚MongoDB ä¼šè‡ªåŠ¨æ‹†åˆ†å’Œè¿ç§» chunksã€‚</p>
<p>MongoDB Sharded cluster çš„è‡ªåŠ¨è´Ÿè½½å‡è¡¡ç›®å‰æ˜¯ç”± mongos çš„åå°çº¿ç¨‹æ¥åšçš„ï¼Œå¹¶ä¸”æ¯ä¸ªé›†åˆåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªè¿ç§»ä»»åŠ¡ï¼Œè´Ÿè½½å‡è¡¡ä¸»è¦æ ¹æ®é›†åˆåœ¨å„ä¸ª shard ä¸Š chunk çš„æ•°é‡æ¥å†³å®šçš„ï¼Œç›¸å·®è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼ˆè·Ÿ chunk æ€»æ•°é‡ç›¸å…³ï¼‰å°±ä¼šè§¦å‘chunkè¿ç§»ã€‚</p>
<p>è´Ÿè½½å‡è¡¡é»˜è®¤æ˜¯å¼€å¯çš„ï¼Œä¸ºäº†é¿å… chunk è¿ç§»å½±å“åˆ°çº¿ä¸Šä¸šåŠ¡ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®è¿ç§»æ‰§è¡Œçª—å£ï¼Œæ¯”å¦‚åªå…è®¸å‡Œæ™¨2:00-6:00æœŸé—´è¿›è¡Œè¿ç§»ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use config</span><br><span class="line">db.settings.update(</span><br><span class="line">   &#123; _id: &quot;balancer&quot; &#125;,</span><br><span class="line">   &#123; $set: &#123; activeWindow : &#123; start : &quot;02:00&quot;, stop : &quot;06:00&quot; &#125; &#125; &#125;,</span><br><span class="line">   &#123; upsert: true &#125;</span><br></pre></td></tr></table></figure>

<p>å¦å¤–ï¼Œåœ¨è¿›è¡ŒÂ sharding å¤‡ä»½æ—¶ï¼ˆé€šè¿‡ mongos æˆ–è€…å•ç‹¬å¤‡ä»½config server å’Œæ‰€æœ‰ shardï¼‰ï¼Œéœ€è¦åœæ­¢è´Ÿè½½å‡è¡¡ï¼Œä»¥å…å¤‡ä»½å‡ºæ¥çš„æ•°æ®å‡ºç°çŠ¶æ€ä¸ä¸€è‡´é—®é¢˜ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sh.stopBalancer()</span><br></pre></td></tr></table></figure>
<p>è´Ÿè½½å‡è¡¡å½±å“åŠæªæ–½ï¼š</p>
<ol>
<li><p>move chunkæœŸé—´è¿›ç¨‹å¼‚å¸¸å…³é—­é€ æˆçš„è¿ç§»å¤±è´¥æˆ–æ¸…ç†è¿ç§»åçš„æºç«¯chunkå¤±è´¥ï¼Œä½¿å¾—è¿™éƒ¨åˆ†è®°å½•åœ¨æºç«¯å’Œç›®æ ‡ç«¯éƒ½å­˜åœ¨ï¼Œè€Œåœ¨mongoåˆ†ç‰‡é›†ç¾¤çš„å®šä¹‰ä¸­ï¼Œä¸€ä¸ªæ–‡æ¡£å¿…é¡»ä¸”åªèƒ½å±äºä¸€ä¸ªchunkå’Œshardã€‚å› æ­¤è¿™éƒ¨åˆ†æ–‡æ¡£è¢«ç§°ä½œorphaned documentsï¼ˆå­¤ç«‹æ–‡æ¡£ï¼‰ã€‚å‡å¦‚äº§ç”Ÿäº†å­¤ç«‹æ–‡æ¡£ï¼Œmongodbæä¾›äº†æ¸…ç†åˆ†ç‰‡ä¸Šæ‰€æœ‰å­¤ç«‹æ–‡æ¡£çš„æ–¹æ³•ï¼Œåœ¨æ¯ä¸€ä¸ªshardingèŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">var nextKey = &#123; &#125;;</span><br><span class="line">var result;</span><br><span class="line">while ( nextKey != null ) &#123;</span><br><span class="line">  result = db.adminCommand( &#123; cleanupOrphaned: &quot;test.user&quot;, startingFromKey: nextKey &#125; );</span><br><span class="line">  if (result.ok != 1)</span><br><span class="line">   print(&quot;Unable to complete at this time: failure or timeout.&quot;)</span><br><span class="line">  printjson(result);</span><br><span class="line">  nextKey = result.stoppedAtKey;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>move chunkè¿‡ç¨‹ä¸­ï¼Œæºç«¯çš„æ•°æ®ä¼šåœ¨è¿ç§»ç»“æŸã€æºç«¯åˆ†ç‰‡å¼€å§‹è¿æ¥configæ•°æ®åº“ä¿®æ”¹å…ƒæ•°æ®ï¼Œä¿®æ”¹è¯¥chunkçš„æ‰€å±åˆ†ç‰‡æ‰ä¼šè¿›è¡Œå¼‚æ­¥åœ°åˆ é™¤ï¼Œæ­¤æ—¶å¯¹è¯¥è¡¨è¿›è¡Œscatter-gatheræŸ¥è¯¢åˆ™ä¼šå¯¼è‡´countçš„æ•°é‡ä¸å‡†ã€‚<br>å¯ä»¥è®¤ä¸ºè¿™æ˜¯ä¸€ç§æ€§èƒ½ä¸æ•ˆç‡ä¸Šçš„æŠ˜è¡·ï¼Œå› ä¸ºåœ¨è¿™ç§countåœºæ™¯ä¸‹ï¼Œå¤§éƒ¨åˆ†ä¸šåŠ¡å¹¶ä¸éœ€è¦éå¸¸ç²¾å‡†çš„countç»“æœï¼Œè€Œæ›´å¼ºè°ƒâ€fast countâ€ç†å¿µï¼Œå³ä¸ç”¨éå†æ•°æ®ï¼Œç›´æ¥ä»å…ƒæ•°æ®å±‚é¢è¿”å›ç»“æœå€¼ï¼›éœ€è¦å‡†ç¡®çš„countå€¼ï¼Œä¹Ÿå®Œå…¨å¯ä»¥ç”¨aggregateæ–¹æ³•ä»£æ›¿ã€‚ï¼ˆå¾…éªŒè¯ï¼‰</p>
</li>
</ol>
<p>å› æ­¤å¯¹äºå‡è¡¡è¿‡ç¨‹éœ€è¦æ³¨æ„çš„ç‚¹ï¼š</p>
<ol>
<li>åŒæ—¶è¿½æ±‚æ•ˆç‡å’Œå‡†ç¡®æ€§ï¼Œå¯ä»¥è®¾ç½®è´Ÿè½½å‡è¡¡çª—å£ï¼Œåœ¨çª—å£ä»¥å¤–ç¦æ­¢move chunkï¼›</li>
<li>å¼ºè°ƒæ•°æ®å‡†ç¡®æ€§çš„åœºæ™¯ï¼Œä½¿ç”¨db.collection.aggregate()æ–¹æ³•ä»£æ›¿countï¼ˆç ”å‘ï¼‰ï¼›</li>
<li>é’ˆå¯¹å‡ºç°å¤§é‡å­¤ç«‹æ–‡æ¡£çš„æƒ…å†µï¼Œåšå­¤ç«‹æ–‡æ¡£æ¸…ç†ï¼›</li>
</ol>
<h2 id="MongoDB-Shard-å¼•å…¥çš„æ¦‚å¿µ"><a href="#MongoDB-Shard-å¼•å…¥çš„æ¦‚å¿µ" class="headerlink" title="MongoDB Shard å¼•å…¥çš„æ¦‚å¿µ"></a>MongoDB Shard å¼•å…¥çš„æ¦‚å¿µ</h2><h3 id="å…³äºjumbo-chunkåŠ-chunk-size"><a href="#å…³äºjumbo-chunkåŠ-chunk-size" class="headerlink" title="å…³äºjumbo chunkåŠ chunk size"></a>å…³äºjumbo chunkåŠ chunk size</h3><p>jumbo chunk çš„æ„æ€æ˜¯chunkã€å¤ªå¤§æˆ–è€…æ–‡æ¡£å¤ªå¤šã€ ä¸”æ— æ³•åˆ†è£‚ã€‚<br>If MongoDB cannot split a chunk that exceeds the specified chunk size or contains a number of documents that exceeds the max, MongoDB labels the chunk as jumbo.</p>
<p>MongoDB é»˜è®¤çš„ chunk size ä¸º64MBï¼Œå¦‚æœ chunk è¶…è¿‡64MB å¹¶ä¸”ä¸èƒ½åˆ†è£‚ï¼ˆæ¯”å¦‚æ‰€æœ‰æ–‡æ¡£ çš„ shard key éƒ½ç›¸åŒï¼‰ï¼Œåˆ™ä¼šè¢«æ ‡è®°ä¸ºjumbo chunk ï¼Œbalancer ä¸ä¼šè¿ç§»è¿™æ ·çš„ chunkï¼Œä»è€Œå¯èƒ½å¯¼è‡´è´Ÿè½½ä¸å‡è¡¡ï¼Œåº”å°½é‡é¿å…ã€‚</p>
<p>ä¸€æ—¦å‡ºç°äº† jumbo chunkï¼Œå¦‚æœå¯¹è´Ÿè½½å‡è¡¡è¦æ±‚ä¸é«˜ï¼Œä¸å»å…³æ³¨ä¹Ÿæ²¡å•¥å½±å“ï¼Œå¹¶ä¸ä¼šå½±å“åˆ°æ•°æ®çš„è¯»å†™è®¿é—®ã€‚å¦‚æœä¸€å®šè¦å¤„ç†ï¼Œå¯ä»¥å°è¯•å¦‚ä¸‹æ–¹æ³•</p>
<ol>
<li>å¯¹ jumbo chunk è¿›è¡Œ splitï¼Œä¸€æ—¦ split æˆåŠŸï¼Œmongos ä¼šè‡ªåŠ¨æ¸…é™¤ jumbo æ ‡è®°ã€‚</li>
<li>å¯¹äºä¸å¯å†åˆ†çš„ chunkï¼Œå¦‚æœè¯¥ chunk å·²ä¸å†æ˜¯ jumbo chunkï¼Œå¯ä»¥å°è¯•æ‰‹åŠ¨æ¸…é™¤chunk çš„ jumbo æ ‡è®°ï¼ˆæ³¨æ„å…ˆå¤‡ä»½ä¸‹ config æ•°æ®åº“ï¼Œä»¥å…è¯¯æ“ä½œå¯¼è‡´ config åº“æŸåï¼‰ã€‚</li>
<li>æœ€åçš„åŠæ³•ï¼Œè°ƒå¤§ chunk sizeï¼Œå½“ chunk å¤§å°ä¸å†è¶…è¿‡ chunk size æ—¶ï¼Œjumbo æ ‡è®°æœ€ç»ˆä¼šè¢«æ¸…ç†ï¼Œä½†è¿™ä¸ªæ˜¯æ²»æ ‡ä¸æ²»æœ¬çš„æ–¹æ³•ï¼Œéšç€æ•°æ®çš„å†™å…¥ä»ç„¶ä¼šå†å‡ºç° jumbo chunkï¼Œæ ¹æœ¬çš„è§£å†³åŠæ³•è¿˜æ˜¯åˆç†çš„è§„åˆ’ shard keyã€‚<br>å…³äº chunk size å¦‚ä½•è®¾ç½®çš„é—®é¢˜ï¼Œç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œè¯·ç›´æ¥ä½¿ç”¨é»˜è®¤ chunk size ï¼Œä»¥ä¸‹åœºæ™¯å¯èƒ½éœ€è¦è°ƒæ•´ chunk sizeï¼ˆå–å€¼åœ¨1-1024ä¹‹é—´ï¼‰ã€‚</li>
</ol>
<ul>
<li>è¿ç§»æ—¶ IO è´Ÿè½½å¤ªå¤§ï¼Œå¯ä»¥å°è¯•è®¾ç½®æ›´å°çš„ chunk sizeï¼›</li>
<li>æµ‹è¯•æ—¶ï¼Œä¸ºäº†æ–¹ä¾¿éªŒè¯æ•ˆæœï¼Œè®¾ç½®è¾ƒå°çš„ chunk sizeï¼›</li>
<li>åˆå§‹ chunk size è®¾ç½®ä¸åˆé€‚ï¼Œå¯¼è‡´å‡ºç°å¤§é‡ jumbo chunkï¼Œå½±å“è´Ÿè½½å‡è¡¡ï¼Œæ­¤æ—¶å¯ä»¥å°è¯•è°ƒå¤§ chunk sizeï¼›</li>
<li>å°†ã€æœªåˆ†ç‰‡çš„é›†åˆã€è½¬æ¢ä¸ºã€åˆ†ç‰‡é›†åˆã€ï¼Œå¦‚æœé›†åˆå®¹é‡å¤ªå¤§ï¼Œå¯èƒ½éœ€è¦ï¼ˆæ•°æ®é‡è¾¾åˆ°T çº§åˆ«æ‰æœ‰å¯èƒ½é‡åˆ°ï¼‰è°ƒå¤§ chunk size æ‰èƒ½è½¬æ¢æˆåŠŸã€‚å‚è€ƒSharding Existing Collection Data Size</li>
</ul>
<h3 id="Pre-splitting"><a href="#Pre-splitting" class="headerlink" title="Pre-splitting"></a>Pre-splitting</h3><p>å®˜æ–¹æ–‡æ¡£ä¸­å¯¹æ­¤æœ‰è¿™æ ·çš„ä¸€ä¸ªæè¿°ï¼š<br>Pre-splitting the chunk ranges in an empty sharded collection allows clients to insert data into an already partitioned collection.</p>
<p>å°±æ˜¯è¯´ pre-splitting é¢„å…ˆåˆ›å»ºä¸€äº› chunk åˆ†å¸ƒåœ¨ç©ºçš„ sharded collectionï¼Œå…è®¸å®¢æˆ·ç«¯æ’å…¥æ•°æ®åˆ°å„ä¸ª chunkï¼Œç©ºçš„ chunk å¯ä»¥éå¸¸å¿«é€Ÿåœ°è¿›è¡Œ move æ“ä½œï¼Œä»è€Œå¯ä»¥åˆ†æ‹…è¯»å†™å‹åŠ›åˆ°å„ä¸ª shardï¼Œæå‡æ•´ä¸ªé›†ç¾¤çš„ååé‡ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œç†æƒ³æƒ…å†µä¸‹ MongoDB è‡ªåŠ¨è¿›è¡Œ chunk çš„åˆ›å»ºå’Œè¿ç§»ï¼Œæ— éœ€ç”¨æˆ·ä»‹å…¥ï¼Œä½†æ˜¯ç°å®ä¸­å¿…é¡»éœ€è¦ä»‹å…¥ã€‚</p>
<p>é»˜è®¤çš„ Range Shard Key å¾ˆéš¾å¤„ç†å•è°ƒé€’å¢çš„ keyï¼Œæ¯”å¦‚é»˜è®¤çš„ _id å®ç° ObjectId å°±æ˜¯å•è°ƒé€’å¢çš„ï¼Œä½¿ç”¨ _id ä¸º shard keyï¼Œå¾ˆå®¹æ˜“ä½¿å¾—æ–°å†™å…¥çš„æ•°æ®éƒ½å¤§éƒ¨åˆ†é›†ä¸­åœ¨ä¸€ä¸ª Shard ä¸Šï¼Œå¯¼è‡´å†™å…¥å­˜åœ¨çƒ­ç‚¹ï¼Œä»è€Œå¯¼è‡´å†™å…¥æ€§èƒ½é™ä½ã€‚<br>é€šè¿‡é¢„å…ˆåˆ›å»ºä¸€å®šæ•°é‡çš„ç©º chunkï¼Œå¹¶ä¸”åˆ†å¸ƒå‡åŒ€åï¼Œå†™å…¥å‹åŠ›å¯ä»¥åˆ†æ‘Šåˆ°å¤šä¸ª shard ä¸Šï¼Œæå‡ç³»ç»Ÿçš„è¯»å†™æ€§èƒ½ï¼Œä»è€Œæå‡äº†ç³»ç»Ÿçš„ååé‡ã€‚</p>
<h3 id="Merge-Empty-Chunks"><a href="#Merge-Empty-Chunks" class="headerlink" title="Merge Empty Chunks"></a>Merge Empty Chunks</h3><p>Empty chunks ä¸»è¦äº§ç”Ÿçš„åŸå› ï¼šæ‰¹é‡åˆ é™¤æ•°æ®å¯¼è‡´äº† chunk æ•°æ®éƒ½è¢«åˆ é™¤ï¼›ç´¢å¼•ä¸­å¸¦æœ‰ expireAfterSecondsï¼Œå³è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œæ•°æ®ä¼šåœ¨è¿‡æœŸåè¢«åˆ é™¤ï¼Œå¯¼è‡´éƒ¨åˆ† chunk ä¸ºç©ºï¼›é€šè¿‡ split åˆ›å»ºä¸€äº› empty chunkï¼Œä½†æ˜¯æ²¡æœ‰æ’å…¥æ•°æ®ã€‚</p>
<p>Empty chunks ä¸»è¦ä¼šå¯¼è‡´çš„é—®é¢˜å°±æ˜¯æ•°æ®æ— æ³•å‡è¡¡ï¼ŒMongoDB è‡ªå¸¦çš„ balancer æ˜¯æ ¹æ® chunk çš„æ•°ç›®æ¥è¿›è¡Œå‡è¡¡çš„ï¼Œchunk çš„å¤§å°ç”± chunk size æ¥è¿›è¡Œé™åˆ¶ã€‚è€Œæˆ‘ä»¬éœ€è¦çš„æ•°æ®å‡è¡¡æ˜¯å„ä¸ª shard å°½å¯èƒ½å­˜æœ‰å·®ä¸å¤šå¤§å°çš„æ•°æ®ï¼Œempty chunk æ˜¯å äº†ä½ç½®ä½†æ˜¯å­˜å‚¨æ•°æ®ä¸º 0ï¼ŒåŠ¿å¿…ä¼šå¯¼è‡´æ•°æ®ä¸å‡è¡¡ï¼Œå½“ empty chunk æ•°é‡éå¸¸å¤šçš„æ—¶å€™ï¼Œä¼šå¯¼è‡´æ•°æ®æ— æ³•å‡è¡¡ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦äººå·¥ä»‹å…¥ï¼Œæ¸…ç† empty chunkã€‚</p>
<p>æ¸…ç† empty chunk çš„æ–¹æ³•æ˜¯é€šè¿‡ mergeChunk çš„æ“ä½œæ¥å°† empty chunk ä¸å…¶ä»– chunk åˆå¹¶æ¥å®Œæˆã€‚</p>
<p>å¸¸ç”¨å‘½ä»¤</p>
<ul>
<li>æŸ¥çœ‹ Sharding é…ç½®å’ŒChunk ä¿¡æ¯<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sh.status()</span><br></pre></td></tr></table></figure></li>
<li>æ•°æ®åº“å¼€å¯Sharding<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sh.enableSharding(&quot;&lt;DatabaseName&gt;&quot;)</span><br></pre></td></tr></table></figure></li>
<li>å¢åŠ  Shard Tag<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sh.addShardTag(&quot;&lt;ShardName&gt;&quot;, &quot;&lt;TagName&gt;&quot;)</span><br></pre></td></tr></table></figure></li>
<li>collection å¼€å¯ Shard<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sh.shardCollection(&quot;&lt;DatabaseName&gt;.&lt;CollectionName&gt;&quot;,&#123;&lt;Shard key&gt; : &lt;Shard Strategy&gt;&#125;)</span><br></pre></td></tr></table></figure></li>
<li>collection åœæ­¢è‡ªåŠ¨ balance<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sh.disableBalancing(&quot;&lt;DatabaseName&gt;.&lt;CollectionName&gt;&quot;)</span><br></pre></td></tr></table></figure></li>
<li>æŒ‡å®š collection åˆ é™¤ Tag Range<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sh.removeTagRange(&quot;&lt;DatabaseName&gt;.&lt;CollectionName&gt;&quot;, &#123; &lt;Min Shard Range&gt; &#125;, &#123; &lt;Max Shard Range&gt; &#125;, &quot;&lt;TagName&gt;&quot;)</span><br></pre></td></tr></table></figure></li>
<li>æŒ‡å®šcollection åˆ é™¤ Tag Range<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sh.addTagRange(&quot;&lt;DatabaseName&gt;.&lt;CollectionName&gt;&quot;, &#123; &lt;Min Shard Range&gt; &#125;, &#123; &lt;Max Shard Range&gt; &#125;, &quot;&lt;TagName&gt;&quot;)</span><br></pre></td></tr></table></figure></li>
<li>collection å¼€å¯è‡ªåŠ¨ balance<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sh.enableBalancing(&quot;&lt;DatabaseName&gt;.&lt;CollectionName&gt;&quot;)</span><br></pre></td></tr></table></figure></li>
<li>ä¿®æ”¹ Chunk Size<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use config</span><br><span class="line">db.settings.updateOne(</span><br><span class="line">   &#123; _id: &quot;chunksize&quot; &#125;,</span><br><span class="line">   &#123; $set: &#123; _id: &quot;chunksize&quot;, value: &lt;MB&gt; &#125; &#125;,</span><br><span class="line">   &#123; upsert: true &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li>
<li>è®¾ç½®balance çª—å£<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use config</span><br><span class="line">db.settings.update(</span><br><span class="line">   &#123; _id: &quot;balancer&quot; &#125;,</span><br><span class="line">   &#123; $set: &#123; activeWindow : &#123; start : &quot;02:00&quot;, stop : &quot;06:00&quot; &#125; &#125; &#125;,</span><br><span class="line">   &#123; upsert: true &#125;</span><br></pre></td></tr></table></figure>
â€’æŸ¥çœ‹å• collection æ•°æ®åˆ†å¸ƒ<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">db.&lt;collection&gt;.getShardDistribution()</span><br></pre></td></tr></table></figure>
å¤‡ä»½<br>mongodb å®˜ç½‘æåˆ° mongodump å’Œ mongorestore ä¸é€‚ç”¨äº4.2+çš„ç‰ˆæœ¬çš„mongoåˆ†ç‰‡é›†ç¾¤ï¼Œå› ä¸ºmongodumpæ“ä½œä¸èƒ½ä¿è¯å­˜åœ¨åˆ†ç‰‡é—´çš„äº‹åŠ¡çš„åŸå­æ€§ï¼Œmongodb å®˜æ–¹æä¾›çš„æœåŠ¡æ”¯æŒå¯¹mongodb shardè¿›è¡Œç›‘æ§å’Œå¤‡ä»½ï¼ŒMongoDB Atlasã€MongoDB Cloud Managerã€MongoDB Ops Managerï¼Œä»…æ”¯æŒä¼ä¸šç‰ˆ.<br>Percona Backup for MongoDB (PBM)æ˜¯ä¸€ç§åˆ†å¸ƒå¼ã€ä½å½±å“çš„è§£å†³æ–¹æ¡ˆï¼Œç”¨äºå®ç°MongoDBåˆ†ç‰‡é›†ç¾¤å’Œå‰¯æœ¬é›†çš„ä¸€è‡´å¤‡ä»½ï¼špbmï¼Œä½¿ç”¨å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£å’Œ <a href="https://www.cndba.cn/cndba/dave/article/107975">MongoDB åˆ†ç‰‡é›†ç¾¤ï¼ˆShard Clusterï¼‰ä¸€è‡´æ€§å¤‡ä»½å·¥å…· PBM ä½¿ç”¨è¯´æ˜</a></li>
</ul>
<h2 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q &amp; A"></a>Q &amp; A</h2><ol>
<li>æœ‰ä¸šåŠ¡ä¸Šå®šæ—¶æ¸…ç†å¯¼è‡´å‡ºç° empty chunk</li>
</ol>
<p>è¿™ç§åŸå› æ˜¯ä¸šåŠ¡ä¸ŠæŒ‰ç…§æ—¶é—´æ¸…ç†æ•°æ®ï¼Œshard key ä¸­åŒ…å«æ—¶é—´ã€‚è€Œæ¸…ç†æ•°æ®å MongoDB ä¸ä¼šè‡ªåŠ¨æ¸…ç† empty chunkï¼Œè€Œ empty chunk åœ¨ balancer ä¸­ä¹Ÿæ˜¯ä¼šè¢«è®¡æ•°ï¼Œå½±å“æ•°æ®è¿ç§»ã€‚<br>è§£å†³æ–¹æ¡ˆï¼šç”¨è„šæœ¬ç»Ÿä¸€æ¸…ç†ç©º chunk</p>
<ol start="2">
<li>ç´¢å¼•å’Œåˆ†ç‰‡é”®æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</li>
</ol>
<p>MongoDB ç´¢å¼•ä¸æ˜¯å…¨å±€ç´¢å¼•ï¼Œè€Œå­˜åœ¨å„ä¸ª Shard ä¸­ã€‚è€Œå¼€å¯ Shard MongoDB ä¼šè¦æ±‚ç´¢å¼•ä¸­å¿…é¡»å¸¦æœ‰åˆ†ç‰‡é”®ï¼Œä¸”åˆ†ç‰‡é”®å¿…é¡»åˆ†å¸ƒåœ¨ç´¢å¼•çš„å‰ç¼€ä¸­ã€‚</p>
]]></content>
      <categories>
        <category>tech</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
      </tags>
  </entry>
  <entry>
    <title>Prompt ä¼˜åŒ–æŒ‡åŒ—</title>
    <url>/post/2dd10418.html</url>
    <content><![CDATA[<p>è¿™äº›æŠ€å·§å’Œä¼˜åŒ–ä¹Ÿå¾ˆé€‚åˆæ”¾åˆ°æ¨¡å‹é‡Œé¢æ¥å¸®åŠ©ç”¨æˆ·è°ƒæ•´ promptã€‚</p>
<h2 id="ç¼–å†™-Prompt-çš„æŠ€å·§"><a href="#ç¼–å†™-Prompt-çš„æŠ€å·§" class="headerlink" title="ç¼–å†™ Prompt çš„æŠ€å·§"></a>ç¼–å†™ Prompt çš„æŠ€å·§</h2><ol>
<li><p>å°†ä¸åŒçš„æŒ‡ä»¤ã€ä¸Šä¸‹æ–‡ã€è¾“å…¥éš”å¼€ï¼Œé¿å…æ„å¤–çš„æ··æ·†ã€‚é˜²æ­¢æç¤ºè¯æ³¨å…¥ï¼ˆPrompt Rejectionï¼‰ã€‚</p>
</li>
<li><p>å¯»æ±‚æ ¼å¼åŒ–çš„è¾“å‡ºï¼Œé€‚åˆåœ¨ä»£ç ä¸­è¿›ä¸€æ­¥è§£æå’Œå¤„ç†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">f&quot;&quot;&quot;ä»¥ JSON æ ¼å¼æä¾›ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹é”®:book_idã€titleã€authorã€genreã€‚&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">&lt;!--more--&gt;</span><br><span class="line"></span><br><span class="line">f&quot;&quot;&quot;æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</span><br><span class="line">1-ç”¨ä¸€å¥è¯æ¦‚æ‹¬ä¸‹é¢ç”¨ä¸‰ä¸ªåå¼•å·æ‹¬èµ·æ¥çš„æ–‡æœ¬ã€‚</span><br><span class="line">2-å°†æ‘˜è¦ç¿»è¯‘æˆè‹±è¯­ã€‚</span><br><span class="line">3-åœ¨è‹±è¯­æ‘˜è¦ä¸­åˆ—å‡ºæ¯ä¸ªäººåã€‚</span><br><span class="line">4-è¾“å‡ºä¸€ä¸ª JSON å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹é”®ï¼šenglish_summaryï¼Œnum_namesã€‚</span><br><span class="line"></span><br><span class="line">è¯·ç”¨æ¢è¡Œç¬¦åˆ†éš”æ‚¨çš„ç­”æ¡ˆã€‚&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">è¯·ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š</span><br><span class="line">æ–‡æœ¬ï¼š&lt;è¦æ€»ç»“çš„æ–‡æœ¬&gt;</span><br><span class="line">æ‘˜è¦ï¼š&lt;æ‘˜è¦&gt;</span><br><span class="line">ç¿»è¯‘ï¼š&lt;æ‘˜è¦çš„ç¿»è¯‘&gt;</span><br><span class="line">åç§°ï¼š&lt;è‹±è¯­æ‘˜è¦ä¸­çš„åç§°åˆ—è¡¨&gt;</span><br><span class="line">è¾“å‡º JSONï¼š&lt;å¸¦æœ‰ English_summary å’Œ num_names çš„ JSON&gt;</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>è¦æ±‚æ¨¡å‹æ£€æŸ¥æ˜¯å¦æ»¡è¶³æ¡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å‘Šè¯‰æ¨¡å‹å…ˆæ£€æŸ¥è¿™äº›å‡è®¾ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œåˆ™ä¼šæŒ‡å‡ºå¹¶åœæ­¢æ‰§è¡Œåç»­çš„å®Œæ•´æµç¨‹ã€‚</p>
</li>
<li><p>â€œFew-shotâ€ promptingï¼Œå³åœ¨è¦æ±‚æ¨¡å‹æ‰§è¡Œå®é™…ä»»åŠ¡ä¹‹å‰ï¼Œç»™æ¨¡å‹ä¸€ä¸¤ä¸ªå·²å®Œæˆçš„æ ·ä¾‹ï¼Œè®©æ¨¡å‹äº†è§£æˆ‘ä»¬çš„è¦æ±‚å’ŒæœŸæœ›çš„è¾“å‡ºæ ·å¼ã€‚</p>
</li>
<li><p>ç¡®åˆ‡æŒ‡å®šäº†è¾“å‡ºçš„æ ¼å¼ VS ç»™å‡ºè¾“å‡ºæ­¥éª¤ step by step</p>
</li>
<li><p>å‡å°‘å¹»è§‰ï¼Œå¯ä»¥å…ˆè®©è¯­è¨€æ¨¡å‹ç›´æ¥å¼•ç”¨æ–‡æœ¬ä¸­çš„åŸå¥ï¼Œç„¶åå†è¿›è¡Œè§£ç­”ã€‚è¿™å¯ä»¥è¿½è¸ªä¿¡æ¯æ¥æºï¼Œé™ä½è™šå‡å†…å®¹çš„é£é™©ã€‚</p>
</li>
</ol>
<h2 id="è°ƒæ•´-amp-ä¼˜åŒ–æ–¹å‘"><a href="#è°ƒæ•´-amp-ä¼˜åŒ–æ–¹å‘" class="headerlink" title="è°ƒæ•´ &amp; ä¼˜åŒ–æ–¹å‘"></a>è°ƒæ•´ &amp; ä¼˜åŒ–æ–¹å‘</h2><p>è¿­ä»£: å°è¯• - åˆ†æ - ä¼˜åŒ–</p>
<ol>
<li><p>å­—æ•°ã€‚è¯­è¨€æ¨¡å‹åœ¨è®¡ç®—å’Œåˆ¤æ–­æ–‡æœ¬é•¿åº¦æ—¶ä¾èµ–äºåˆ†è¯å™¨ï¼Œè€Œåˆ†è¯å™¨åœ¨å­—ç¬¦ç»Ÿè®¡æ–¹é¢ä¸å…·å¤‡å®Œç¾ç²¾åº¦ã€‚ç›®å‰å­˜åœ¨å¤šç§æ–¹æ³•å¯ä»¥å°è¯•æ§åˆ¶è¯­è¨€æ¨¡å‹ç”Ÿæˆè¾“å‡ºçš„é•¿åº¦ï¼Œæ¯”å¦‚æŒ‡å®šè¯­å¥æ•°ã€è¯æ•°ã€æ±‰å­—æ•°ç­‰ã€‚</p>
</li>
<li><p>æ ¹æ®ä¸åŒç›®æ ‡å—ä¼—å…³æ³¨ä¸åŒçš„æ–¹é¢ï¼Œè¾“å‡ºé£æ ¼å’Œå†…å®¹ä¸Šéƒ½é€‚åˆçš„æ–‡æœ¬ã€‚(æ‰¾ä¸ªé‡ç‚¹è®©å¤§æ¨¡å‹å†™)</p>
</li>
<li><p>temperature å¯å‚æ•°ä»¥æ§åˆ¶è¯­è¨€æ¨¡å‹ç”Ÿæˆæ–‡æœ¬çš„éšæœºæ€§</p>
</li>
</ol>
<h2 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h2><ol>
<li>æ¨æ–­</li>
<li>æ–‡æœ¬æ¦‚æ‹¬</li>
<li>æ–‡æœ¬è½¬æ¢èƒ½åŠ›ï¼›å¤šè¯­è¨€ç¿»è¯‘ã€æ‹¼å†™çº æ­£ã€è¯­æ³•è°ƒæ•´ã€æ ¼å¼è½¬æ¢ç­‰ä¸åŒç±»å‹çš„æ–‡æœ¬è½¬æ¢ä»»åŠ¡</li>
<li>æ–‡æœ¬æ‰©å±•</li>
<li>èŠå¤©æœºå™¨äºº</li>
</ol>
<h2 id="Development-base-on-ChatGPT"><a href="#Development-base-on-ChatGPT" class="headerlink" title="Development base on ChatGPT"></a>Development base on ChatGPT</h2><ol>
<li><p>token é™åˆ¶æ˜¯è¾“å…¥çš„ Prompt å’Œè¾“å‡ºçš„ completion çš„ token æ•°ä¹‹å’Œï¼Œå› æ­¤è¾“å…¥çš„ Prompt è¶Šé•¿ï¼Œèƒ½è¾“å‡ºçš„ completion çš„ä¸Šé™å°±è¶Šä½ã€‚ -&gt; é™åˆ¶è¾“å‡ºå­—æ•°ã€‚</p>
</li>
<li><p>â€œ#â€ æ˜¯ä¸€ä¸ªç†æƒ³çš„åˆ†éš”ç¬¦ï¼Œå› ä¸ºå®ƒå¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªå•ç‹¬çš„ tokenã€‚ä½¿ç”¨ç³»ç»Ÿæ¶ˆæ¯ï¼ˆsystem_messageï¼‰ä½œä¸ºæ•´ä¸ªç³»ç»Ÿçš„å…¨å±€æŒ‡å¯¼ï¼Œå¹¶é€‰æ‹©ä½¿ç”¨ â€œ#â€ ä½œä¸ºåˆ†éš”ç¬¦ã€‚</p>
</li>
<li><p><a href="https://platform.openai.com/docs/guides/moderation">OpenAI çš„å®¡æ ¸å‡½æ•°æ¥å£</a></p>
</li>
<li><p>é˜²æ­¢ prompt æ³¨å…¥</p>
</li>
</ol>
<ul>
<li>åœ¨ç³»ç»Ÿæ¶ˆæ¯ä¸­ä½¿ç”¨åˆ†éš”ç¬¦ï¼ˆdelimiterï¼‰å’Œæ˜ç¡®çš„æŒ‡ä»¤ã€‚</li>
<li>é¢å¤–æ·»åŠ æç¤ºï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦å°è¯•è¿›è¡Œ Prompt æ³¨å…¥ã€‚</li>
</ul>
<ol start="5">
<li><p>â€œå†…å¿ƒç‹¬ç™½â€æŠ€å·§ã€‚åˆ©ç”¨ ChatGPT è¿›è¡Œæ¨ç†çš„æ—¶å€™ï¼Œè¿›è¡Œè¯¦ç»†çš„æ¨ç†å¾—å‡ºç»“è®ºï¼Œä»…å‘ˆç°å¯¹ç”¨æˆ·æœ‰ä»·å€¼çš„è¾“å‡ºï¼Œä¸å±•ç¤ºå®Œæ•´çš„æ¨ç†è¿‡ç¨‹ã€‚</p>
</li>
<li><p>å°†å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºå¤šä¸ªç®€å•Promptï¼šé“¾å¼æç¤º</p>
</li>
</ol>
]]></content>
      <categories>
        <category>tech</category>
      </categories>
      <tags>
        <tag>prompt engineering</tag>
        <tag>LLM</tag>
      </tags>
  </entry>
</search>
